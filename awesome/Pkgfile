# Description: awesome window manager
# URL: http://awesomewm.org/
# Maintainer:  Samsky
# Depends on: lua51, git, imagemagick, xmlto, cmake, asciidoc, cairo, libev, xorg-xcb-util-keysyms, xorg-xcb-util-wm, xorg-xcb-util-cursor, dbus, xmessage, startup-notification, docbook-xsl, docbook-xml, libxdg-basedir, lua-lgi, xorg-xcb-util-xrm, gdk-pixbuf, libxkbcommon

name=awesome
version=4.1
release=1
source=(https://github.com/awesomeWM/awesome-releases/raw/master/$name-$version.tar.xz)

build() {
	local i

	cd $name-$version
	mv awesomerc.lua awesomerc.lua.in
	sed '405,406 s/awesomerc.lua/awesomerc.lua.in/' -i awesomeConfig.cmake
	sed 's/^lua /lua5.1 /' -i build-utils/lgi-check.sh
	sed 's@^\s*COMMAND ${XMLTO_EXECUTABLE} man ${xmlfile}@COMMAND ${XMLTO_EXECUTABLE} --searchpath "/usr/share/xml/docbook/xsl-stylesheets/manpages:/usr/share/xml/docbook/xml-dtd-4.5" man ${xmlfile}@' -i CMakeLists.txt

	cmake ../$name-$version \
		-DCMAKE_BUILD_TYPE=RELEASE \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DSYSCONFDIR=/etc \
		-DLUA_LIBRARY=/usr/lib/liblua5.1.so

	make
	make DESTDIR=$PKG install

	rm -rf $PKG/usr/share/doc
	rm $PKG/usr/share/awesome/themes/default/README

	# get rid of non-English manpages
	for i in $PKG/usr/share/man/*; do
		local j=${i##*/}
		if [ ${#j} -lt 3 ]; then
			rm -rf $i
		fi
		if [ $(expr index $j "_") -gt 0 ]; then
			rm -rf $i
		fi
	done
}
